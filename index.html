<html>
<head>
  <meta charset="UTF-8">
  <script src="js/p5.min.js"></script>
  <script>
    var x = 0, y = 0, estado, passos = 3;
    var posicao = 0, cont = 0, delay = 5;
    var vida_Jog = 100;
        
    var x2 = 500, y2 = 500; //Coordenadas do Indio
    var posicao2 = 0, cont2 = 0;
    var vida_Ind = 70;
    
    var aux, dist, aux2;
    
    var vida = 100, coracao; //                 ------------------------------------------ Ajeitar a vida
    var balas = 15, cartucho;                                 //                           E as balas
    var madeira = 0, tora;
    
    //ARMAS
    var espingarda, sabre;
    var xSabre, ySabre;
    var xEsping, yEsping;
    
    var arma = 0; //Define qual arma vai usar (0 para Sabre, 1 para Espingarda)
    var quantTiros = 3, abertura = 10, cadencia = 30, velocTiro = 60, contTiros = 0, alcance = 400;
    var Xtiro = [3], Ytiro = [3];
    var xAlvo, yAlvo;
    var direcao; //Indica a direçao do mouse (0: Direita, 1: Esquerda)
    var danoEsping = 10;
    
    Xtiro[0] = -10;
    Xtiro[1] = -10;
    Xtiro[2] = -10;

    Ytiro[0] = -10;
    Ytiro[1] = -10;
    Ytiro[2] = -10;
   
    var i;
    var angulo;
    
    var Jog_Frente = [];
    var Jog_Direita = [];
    var Jog_Esquerda = [];
    var Jog_Tras = [];
    
    var Ind_Frente = [];
    var Ind_Direita = [];
    var Ind_Esquerda = [];
    var Ind_Tras = [];
    
    var dead;

    
function preload(){
  //Salva as img de movimentação dos persongagens
  
  //JOGADOR
  Jog_Frente[0] = loadImage("Imagens/Jogador - Frente0.png");
  Jog_Frente[1] = loadImage("Imagens/Jogador - Frente1.png");
  Jog_Frente[2] = loadImage("Imagens/Jogador - Frente2.png");
  Jog_Frente[3] = loadImage("Imagens/Jogador - Frente3.png");
  
  Jog_Direita[0] = loadImage("Imagens/Jogador - Direita0.png");
  Jog_Direita[1] = loadImage("Imagens/Jogador - Direita1.png");
  Jog_Direita[2] = loadImage("Imagens/Jogador - Direita2.png");
  Jog_Direita[3] = loadImage("Imagens/Jogador - Direita3.png");
  
  Jog_Esquerda[0] = loadImage("Imagens/Jogador - Esquerda0.png");
  Jog_Esquerda[1] = loadImage("Imagens/Jogador - Esquerda1.png");
  Jog_Esquerda[2] = loadImage("Imagens/Jogador - Esquerda2.png");
  Jog_Esquerda[3] = loadImage("Imagens/Jogador - Esquerda3.png");
  
  Jog_Tras[0] = loadImage("Imagens/Jogador - Trás0.png");
  Jog_Tras[1] = loadImage("Imagens/Jogador - Trás1.png");
  Jog_Tras[2] = loadImage("Imagens/Jogador - Trás2.png");
  Jog_Tras[3] = loadImage("Imagens/Jogador - Trás3.png");
  
  
  
  //ÍNDIO
  Ind_Frente[0] = loadImage("Imagens/Índio - Frente0.png");
  Ind_Frente[1] = loadImage("Imagens/Índio - Frente1.png");
  Ind_Frente[2] = loadImage("Imagens/Índio - Frente2.png");
  Ind_Frente[3] = loadImage("Imagens/Índio - Frente3.png");
    
  Ind_Direita[0] = loadImage("Imagens/Índio - Direita0.png");
  Ind_Direita[1] = loadImage("Imagens/Índio - Direita1.png");
  Ind_Direita[2] = loadImage("Imagens/Índio - Direita2.png");
  Ind_Direita[3] = loadImage("Imagens/Índio - Direita3.png");
  
  Ind_Esquerda[0] = loadImage("Imagens/Índio - Esquerda0.png");
  Ind_Esquerda[1] = loadImage("Imagens/Índio - Esquerda1.png");
  Ind_Esquerda[2] = loadImage("Imagens/Índio - Esquerda2.png");
  Ind_Esquerda[3] = loadImage("Imagens/Índio - Esquerda3.png");
  
  Ind_Tras[0] = loadImage("Imagens/Índio - Trás0.png");
  Ind_Tras[1] = loadImage("Imagens/Índio - Trás1.png");
  Ind_Tras[2] = loadImage("Imagens/Índio - Trás2.png");
  Ind_Tras[3] = loadImage("Imagens/Índio - Trás3.png");
  
  dead = loadImage ("Imagens/WASTED(1).png");
  
  coracao = loadImage ("Imagens/Vida.png");
  cartucho = loadImage ("Imagens/Munição 3.png");
  tora = loadImage ("Imagens/Madeira.png");
  
  //ARMAS
  espingarda = loadImage ("Imagens/Espingarda.png");
  sabre = loadImage ("Imagens/Sabre2.png");
  
}
    
function setup() {
  createCanvas(windowWidth, windowHeight);
  aux = Jog_Frente[0];
  aux2 = Ind_Frente[0];
}

function draw() {
    background ("white");

    if(keyIsPressed == true)
      estado = key;
    else
      estado = 0;
  
      
    switch (estado){ //MOVIMENTO DO JOGADOR
      case 'ArrowUp':
        if (colisao(x, y - passos, 32, 77, x2, y2, 32, 77) == false){
          y -= passos;
          aux = Jog_Tras[posicao];
        }
        break;
      
      case 'ArrowDown':
        if (colisao(x, y + passos, 32, 77, x2, y2, 32, 77) == false){
          y += passos;
          aux = Jog_Frente[posicao];
        }
        break;
    
      case 'ArrowRight':
        if (colisao(x + passos, y, 32, 77, x2, y2, 32, 77) == false){
          x += passos;
          aux = Jog_Direita[posicao];
        }  
        break;
      
      case 'ArrowLeft':
        if (colisao(x - passos, y, 32, 77, x2, y2, 32, 77) == false){
          x -= passos;
          aux = Jog_Esquerda[posicao];
        }
        break;
        
      case 'Control':
        madeira++;
        break;
        
    }
  
    if (keyIsPressed == true){ //Animação da sprite do jogador
      if (cont == delay){
        posicao++;
        cont = 0;
      }
      else
        cont++;
    }
    if (posicao > 3)
      posicao = 0;
  
  
  
  
    noFill();
    ellipse (x2, y2, 400, 400); //área de perseguição
    ellipse (x2, y2, 200, 200); //área de ataque
    image (aux, x, y); //Exibe o jogador com a imagem atualizada nos x e y já modificados
    
    dist = Math.sqrt( (y - y2)**2 + (x - x2)**2 );
      
     
  
    if (dist <= 200 && vida_Ind > 0){ // Área de Ataque do Indio
      
      if (cont2 == delay){//Animação da Sprite do Índio
        posicao2++;
        cont2 = 0;
      }
      else
        cont2++;
    
      if (posicao2 > 3)
        posicao2 = 0;
      
      
      // MOVIMENTAÇÃO DO INDIO
      if (x2 < x && colisao (x2 + 1, y2, 33, 77, x, y, 33, 77) == false){ //Jogador à direita do Indio 
        x2++;
        aux2 = Ind_Direita[posicao2];
      }
      if (x2 > x && colisao (x2 - 1, y2, 33, 77, x, y, 33, 77) == false){ //Jogador à esquerda do Indio
        x2--;
        aux2 = Ind_Esquerda[posicao2];
      }
      if (y2 < y && colisao (x2, y2 + 1, 33, 77, x, y, 33, 77) == false){ //Jogador abaixo do Indio
        y2++;
        aux2 = Ind_Frente[posicao2];
      }
      if (y2 > y && colisao (x2, y2 - 1, 33, 77, x, y, 33, 77) == false){ //Jogador acima do Indio 
        y2--;
        aux2 = Ind_Tras[posicao2];
      }
      
      image (aux2, x2, y2); //Exibe o Indio com imagem e coordenadas já atualizadas
    }
  
  if (dist > 200 && vida_Ind > 0)
    image (Ind_Frente[0], x2, y2);
  
  
  if (dist < 100 && vida_Ind > 0){ //Área de ataque do Índio
    vida = vida - (1/5);
  }
  
  
  
  
  //HUD
  image (coracao, 20, 20);
  image (cartucho, 20, 62);
  image (tora, 20, 104);
  
  push();
  textSize (30);
  stroke("black");
  
  fill ("white");
  rect (70, 26, 100, 20, 5);
  fill ("red");
  rect (70, 26, vida, 20, 5);
  
  fill ("green");
  text (madeira, 80, 145);
  
  //CONFIG BALAS
  if (balas > 10)
    fill ("green");
  
  if (balas <= 10 && balas > 5)
    fill ("yellow");
  
  if (balas <= 5)
    fill ("red");
  
  text (balas, 80, 90);
  pop();
  
  xSabre = x + 18;
  ySabre = y + 48;
  
  xEsping = x + 24;
  yEsping = y + 51;
  
  angulo = atan2 (mouseY - ySabre, mouseX - xSabre);
  
  
  if (angulo >= -HALF_PI && angulo <= HALF_PI){//Mouse na direita
    direcao = 0;
    push();
    if (arma == 0){ // Exibe o sabre
      translate (xSabre, ySabre);
      rotate(angulo);
      image (sabre, 5, -10);
    }
    else{ // Exibe a espingarda
      translate (xEsping, yEsping);
      rotate(angulo);
      image (espingarda, -20, -19);
    }
    
    pop();
  }
  if (angulo < -HALF_PI || angulo > HALF_PI){//Mouse na esquerda
    direcao = 1;
    push();
    
    if (arma == 0){ // Exibe o sabre
      translate (xSabre, ySabre);
      rotate(angulo);
      scale (1,-1);
      image (sabre, 5, -10);
    }
    else{ // Exibe a espingarda
      translate (xEsping, yEsping);
      rotate(angulo);
      scale (1,-1);
      image (espingarda, -20, -19);
    }
    
    pop();
  }
  
  
  
  //TIRO
  for (i = 0; i < quantTiros; i++){
    if (Xtiro[i] != -10){// Trajeto da bala
      
      if (direcao == 0)//Mouse p/ Direita
        Xtiro[i] += velocTiro;
      else              //Mouse p/ Esquerda
        Xtiro[i] -= velocTiro;
        
      Ytiro[i] = trajetoBala(xEsping, yEsping, xAlvo, yAlvo, Xtiro[i]);
      
      if (i == 0) // Efeito de dispersão das balas da espingarda
        Ytiro[i] -= abertura ;
      if (i == 2)
        Ytiro[i] += abertura; 
    }
    
    
    if (Xtiro[i] > xEsping + alcance || Xtiro[i] < xEsping - alcance){ //Limita o alcance da bala
      Xtiro[i] = -10;      
      Ytiro[i] = -10;
    }
    if (Ytiro[i] > yEsping + alcance || Ytiro[i] < yEsping - alcance){
      Xtiro[i] = -10;      
      Ytiro[i] = -10;  
    }
    
    push(); //Estiliza a bala
      rectMode (CENTER);
      fill (255, 255, 0);
      stroke (255, 100, 0);
      strokeWeight (4);
      rect (Xtiro[i], Ytiro[i], 10, 10); 
    pop();
  }
  abertura += 3;
  contTiros++;
  
  
  
  
  //DANO
  for (i = 0; i < quantTiros; i++){
    if (colisao(x2, y2, 33, 77, Xtiro[i] - 5, Ytiro[i] - 5, 10, 10) == true){ //Se o indio for atingido por um tiro de espingarda
      if (vida_Ind - danoEsping >= 0)//Não deixa a vida do Indio ficar negativa
        vida_Ind -= danoEsping;
      else
        vida_Ind = 0;
    }
  }
  
  
  
  if (vida_Ind > 0){
    //Exibe a vida do Indio
    fill ("white");
    rect (x2 - 14, y2 - 10, 70, 6);
    fill ("green");
    rect (x2 - 14, y2 - 10, vida_Ind, 6);
  }
  else{
    image (dead, x2, y2, 46, 60);
  }
  
  
  
 
  
  
  
  //COORD. DOS PERS.
  fill ("black");
  text ("x: " + x + ", y: " + y, x, y - 20);
  text ("x: " + x2 + ", y: " + y2, x2, y2 - 20);
}
    
function colisao(xA, yA, compA, altA, xB, yB, compB, altB){
  //Colisão entre dois objetos A e B.
  //Entrar com as coordenadas (x e y) bem como o comprimento e altura de ambos.
  
  if (xA + compA < xB) //A está a esquerda de B
    return false;
  if (xB < xA - compB) //A está a direita de B
    return false;
  if (yA - altB > yB) //A está embaixo de B
    return false;
  if (yA + altA < yB) //A está acima de B
    return false;
  
  return true; //Se ele não entrar em nenhuma dessas 4 situações,
               //então ele está colidindo
}
    
    
function mouseClicked(){
 if (arma == 1 && balas >= 3){ //Tá com a espingarda e tem munição
   
   if (contTiros > cadencia){//Disparo
    xAlvo = mouseX;
    yAlvo = mouseY; 
    
    Xtiro[0] = xEsping + 10;
    Xtiro[1] = xEsping + 10; //Setar na arma
    Xtiro[2] = xEsping + 10;

    Ytiro[0] = yEsping - 10;
    Ytiro[1] = yEsping - 10; //Setar na arma
    Ytiro[2] = yEsping - 10;
     
    abertura = 1;
    contTiros = 0;
    balas -= 3;
   }
 }
}
    
function keyPressed (){
 if (key == 'q'){ //Altera a arma
    if (arma == 0)
      arma = 1;
    else
      arma = 0;
  }    
}

function trajetoBala(xI, yI, xF, yF, xTraj){
  //Essa função liga com uma reta dois pontos informados (xI, yI) e (xF, yF)
  //E retorna o y relativo ao x que foi pedido na trajetória (xTraj)
  var a, b, yTraj;
  
  a = (yF - yI)/(xF - xI);
  b = yI - (a * xI);
  
  yTraj = (a * xTraj) + b;
  return yTraj;
}
  
  </script>

  <style> body {padding: 0; margin: 0;} </style>
</head>

<body>
</body>
</html>
